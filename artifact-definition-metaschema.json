{
  "allOf": [
    {
      "$schema": "http://json-schema.org/draft-07/schema",
      "type": "object",
      "description": "Required fields in artifact defintions.",
      "required": [
        "properties"
      ],
      "properties": {
        "properties": {
          "type": "object",
          "required": [
            "data",
            "specs"
          ],
          "properties": {
            "data": {
              "description": "Secure artifact data. Not presented in UI. Row-level encrypted.",
              "type": "object"
            },
            "specs": {
              "description": "Attributes for this artifact type that are presentable and searchable in the Massdriver UI.",
              "type": "object",
              "examples": [
                {
                  "aws": {
                    "region": "us-west-1"
                  },
                  "kubernetes": {
                    "gpus": true
                  }
                },
                {
                  "gcp": {
                    "foo": "bar"
                  }
                }
              ]
            }
          }
        }
      }
    },
    {
      "$schema": "http://json-schema.org/draft-07/schema",
      "description": "Massdriver artifact definition configuration.",
      "type": "object",
      "required": [
        "$md"
      ],
      "properties": {
        "$md": {
          "additionalProperties": false,
          "type": "object",
          "required": [
            "name",
            "access"
          ],
          "dependentRequired": {
            "defaultTargetConnectionGroup": [
              "defaultTargetConnectionGroupLabel"
            ]
          },
          "properties": {
            "containerRepositories": {
              "additionalProperties": false,
              "description": "Enables container repository using this artifact type for authentication.",
              "type": "object",
              "required": [
                "label",
                "cloud"
              ],
              "properties": {
                "label": {
                  "description": "The label in the Massdriver UI.",
                  "type": "string"
                },
                "cloud": {
                  "description": "The cloud this artifact will act upon.",
                  "type": "string",
                  "enum": [
                    "aws",
                    "gcp",
                    "azure"
                  ]
                }
              }
            },
            "dnsZones": {
              "additionalProperties": false,
              "description": "Enables DNS Zones using this artifact type for authentication.",
              "type": "object",
              "required": [
                "label",
                "cloud"
              ],
              "properties": {
                "label": {
                  "description": "The label in the Massdriver UI.",
                  "type": "string"
                },
                "cloud": {
                  "description": "The cloud this artifact will act upon.",
                  "type": "string",
                  "enum": [
                    "aws",
                    "gcp",
                    "azure"
                  ]
                }
              }
            },
            "diagram": {
              "additionalProperties": false,
              "type": "object",
              "properties": {
                "isLinkable": {
                  "type": "boolean",
                  "default": true,
                  "description": "Controls if this artifact type is 'linkable' in the UI. Otherwise it can only be used as a target's default connection."
                }
              }
            },
            "export": {
              "type": "array",
              "minItems": 0,
              "items": {
                "additionalProperties": false,
                "type": "object",
                "required": [
                  "templateLang",
                  "fileFormat",
                  "template",
                  "downloadButtonText"
                ],
                "properties": {
                  "downloadButtonText": {
                    "type": "string",
                    "description": "The text on the download button in the Massdriver UI for this export format."
                  },
                  "templateLang": {
                    "type": "string",
                    "enum": [
                      "liquid"
                    ],
                    "description": "The template language used to render the export file."
                  },
                  "fileFormat": {
                    "description": "The file format to add to the export file.",
                    "type": "string",
                    "enum": [
                      "yaml"
                    ]
                  },
                  "template": {
                    "type": "string",
                    "description": "Base64 encoded version of the template for the export file."
                  }
                }
              }
            },
            "importing": {
              "additionalProperties": false,
              "type": "object",
              "required": [
                "group"
              ],
              "properties": {
                "fileUploadType": {
                  "type": "string",
                  "description": "The file type to accept on the artifact import screen."
                },
                "fileUploadArtifactDataPath": {
                  "type": "array",
                  "default": [
                    "data"
                  ],
                  "examples": [
                    [
                      "data",
                      "authentication"
                    ]
                  ],
                  "items": {
                    "type": "string"
                  },
                  "description": "The key path to store the JSON form of this file under in the artifact"
                },
                "group": {
                  "type": "string",
                  "enum": [
                    "authentication",
                    "data",
                    "networking"
                  ],
                  "description": "The group to put this artifact type under in the artifact import wizard."
                }
              }
            },
            "defaultTargetConnectionGroup": {
              "description": "Enables the artifact type as defaultable for a Massdriver target connection group.",
              "type": "string",
              "oneOf": [
                {
                  "const": "credentials",
                  "title": "Credentials"
                },
                {
                  "const": "networking",
                  "title": "Networking"
                }
              ]
            },
            "defaultTargetConnectionGroupLabel": {
              "description": "Label to show in connection group for this artifact type.",
              "type": "string"
            },
            "access": {
              "description": "Controls whether the definition will be publicly accessible or private to your organization.",
              "type": "string",
              "default": "private",
              "oneOf": [
                {
                  "const": "private",
                  "title": "Private"
                },
                {
                  "const": "public",
                  "title": "Public"
                }
              ]
            },
            "name": {
              "description": "The type name of the artifact definition. This should be unique to your organization and will be prefixed with your organizations slug",
              "type": "string",
              "pattern": "^[a-z0-9-]{3,100}$"
            }
          }
        }
      }
    },
    {
      "$ref": "http://json-schema.org/draft-07/schema#"
    }
  ]
}
